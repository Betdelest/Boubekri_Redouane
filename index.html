<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AR Switch Models + Loader</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    body { margin: 0; background: #000; font-family: Arial, Helvetica, sans-serif; }
    model-viewer { width: 100vw; height: 100vh; }

    .switch-buttons {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 2;
    }

    .switch-buttons button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background-color: #fff;
      font-size: 14px;
      cursor: pointer;
    }

    .download-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      background-color: #fff;
      color: #000;
      font-size: 14px;
      cursor: pointer;
      z-index: 3;
    }

    .ar-button {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      background: #fff;
      border-radius: 6px;
      font-size: 16px;
      z-index: 1;
    }

    #loadingText, #successMessage {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 20px;
      border-radius: 10px;
      z-index: 2;
    }

    #loadingText { bottom: 120px; display: none; }
    #successMessage { bottom: 60px; color: #0f0; display: none; }

    .logo {
      position: absolute;
      top: 70px;
      left: 10px;
      width: 70px;
      z-index: 3;
      cursor: pointer;
    }

    /* Modal (liste de plans) */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }
    .modal {
      width: min(520px, 95%);
      max-height: 80vh;
      overflow: auto;
      background: #111;
      border-radius: 10px;
      padding: 14px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.7);
      color: #fff;
    }
    .modal h3 { margin: 0 0 8px 0; font-size:18px; }
    .modal p { margin: 0 0 12px 0; color: #ccc; font-size:13px; }
    .plan-item {
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      padding:8px;
      border-radius:8px;
      background: rgba(255,255,255,0.02);
      margin-bottom:8px;
    }
    .plan-left { display:flex; gap:10px; align-items:center; }
    .plan-icon { width:44px; height:44px; background:#222; border-radius:6px; display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff }
    .plan-meta { font-size:14px; }
    .plan-meta small { display:block; color:#aaa; font-size:12px; }
    .plan-actions { display:flex; gap:8px; align-items:center; }
    .plan-actions button {
      padding:8px 10px; border-radius:8px; border:0; cursor:pointer; font-size:13px;
      background:#fff; color:#000;
    }
    .modal-footer { display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
    .close-btn { background:#444; color:#fff; border:0; padding:8px 12px; border-radius:8px; cursor:pointer; }
    .download-all { background:#0a84ff; color:#fff; border:0; padding:8px 12px; border-radius:8px; cursor:pointer; }

    @media (max-width:480px){
      .plan-meta { font-size:13px; }
      .plan-icon{ width:40px; height:40px; }
    }
  </style>
</head>
<body>

  <!-- Logo cliquable vers la page Facebook -->
  <a href="https://www.facebook.com/BETL121" target="_blank">
    <img src="BETL.png" alt="Logo Bureau" class="logo" />
  </a>

  <div class="switch-buttons">
    <button onclick="changeModel('Villa_AR.glb')">Architecture</button>
    <button onclick="changeModel('Villa_GC.glb')">G√©nie Civil</button>
  </div>

  <button class="download-btn" onclick="openPlans()">üìÑ T√©l√©charger PDF</button>

  <div id="loadingText">Chargement... 0%</div>
  <div id="successMessage">‚úÖ Mod√®le charg√© avec succ√®s</div>

  <model-viewer 
    id="modelViewer"
    src="Villa_AR.glb"
    ar
    ar-modes="scene-viewer webxr"
    camera-controls
    shadow-intensity="1"
    disable-zoom="false"
    scale="0.01 0.01 0.01"
    environment-image="neutral"
    alt="Mod√®le 3D AR"
    loading="eager"
    reveal="auto"
  >
    <button slot="ar-button" class="ar-button">Voir en R√©alit√© Augment√©e</button>
  </model-viewer>

  <!-- Modal liste plans -->
  <div id="modalBackdrop" class="modal-backdrop" onclick="if(event.target===this) closePlans()">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="plansTitle">
      <h3 id="plansTitle">Plans √† t√©l√©charger</h3>
      <p>S√©lectionnez le plan que vous souhaitez ouvrir ou t√©l√©charger. Les fichiers peuvent √™tre h√©berg√©s localement ou sur GitHub Pages.</p>

      <div id="plansList">
        <!-- Items g√©n√©r√©s dynamiquement -->
      </div>

      <div class="modal-footer">
        <button class="close-btn" onclick="closePlans()">Fermer</button>
        <button class="download-all" onclick="downloadAll()">T√©l√©charger tout</button>
      </div>
    </div>
  </div>

  <script>
    const viewer = document.getElementById('modelViewer');
    const loadingText = document.getElementById('loadingText');
    const successMessage = document.getElementById('successMessage');

    function showSuccessMessage() {
      successMessage.style.display = 'block';
      setTimeout(() => {
        successMessage.style.display = 'none';
      }, 2000);
    }

    viewer.addEventListener('progress', (event) => {
      const progress = Math.floor(event.detail.totalProgress * 100);
      loadingText.textContent = `Chargement... ${progress}%`;
      loadingText.style.display = 'block';

      if (progress === 100) {
        setTimeout(() => {
          loadingText.style.display = 'none';
          showSuccessMessage();
        }, 500);
      }
    });

    function changeModel(path) {
      viewer.src = path;
      loadingText.textContent = 'Chargement... 0%';
      loadingText.style.display = 'block';
      successMessage.style.display = 'none';
    }

    /* =======================
       Liste des plans (modifiable)
       Met ici les PDFs ‚Äî peut √™tre local (Plans_Villa_AR.pdf) ou URL compl√®te GitHub Pages
       Exemples :
        "Plans_Villa_AR.pdf"  (m√™me dossier)
        "https://betdelest.github.io/betl-models/plans/Plans_Villa_AR.pdf"
    =========================*/
    const PLANS = [
      { id: 'arch', name: 'Plan Architecture - Villa', file: 'Plans_Villa_AR.pdf', desc: 'Plans architecturaux (A3, coupes, fa√ßades)' },
      { id: 'gc',   name: 'Plan G√©nie Civil - Villa', file: 'Plans_Villa_GC.pdf', desc: 'Fondations, ferraillage, notes de calcul' },
      // Ajoute d'autres √©l√©ments si n√©cessaire
      // { id:'elect', name:'Plan Electricit√©', file:'Plans_Electricite.pdf', desc:'Sch√©ma √©lectrique' }
    ];

    const modalBackdrop = document.getElementById('modalBackdrop');
    const plansList = document.getElementById('plansList');

    function openPlans() {
      renderPlans();
      modalBackdrop.style.display = 'flex';
    }

    function closePlans() {
      modalBackdrop.style.display = 'none';
    }

    function renderPlans() {
      plansList.innerHTML = '';
      PLANS.forEach(plan=>{
        // cr√©er item
        const item = document.createElement('div');
        item.className = 'plan-item';

        const left = document.createElement('div');
        left.className = 'plan-left';
        const icon = document.createElement('div');
        icon.className = 'plan-icon';
        icon.textContent = 'PDF';
        const meta = document.createElement('div');
        meta.className = 'plan-meta';
        meta.innerHTML = `<strong>${plan.name}</strong><small>${plan.desc || ''}</small>`;

        left.appendChild(icon);
        left.appendChild(meta);

        const actions = document.createElement('div');
        actions.className = 'plan-actions';
        const openBtn = document.createElement('button');
        openBtn.textContent = 'Ouvrir';
        openBtn.onclick = ()=> openPDF(plan.file);

        const dlBtn = document.createElement('button');
        dlBtn.textContent = 'T√©l√©charger';
        dlBtn.onclick = ()=> downloadPDF(plan.file);

        actions.appendChild(openBtn);
        actions.appendChild(dlBtn);

        item.appendChild(left);
        item.appendChild(actions);

        plansList.appendChild(item);
      });
    }

    function openPDF(url) {
      // si url n'est pas une URL compl√®te, on suppose qu'il est dans le m√™me dossier
      const final = resolvePDF(url);
      window.open(final, '_blank');
    }

    function downloadPDF(url) {
      const final = resolvePDF(url);
      // Forcer t√©l√©chargement : cr√©er un <a download>
      const a = document.createElement('a');
      a.href = final;
      // si le fichier vient d'un autre domaine, 'download' peut √™tre ignor√© par le navigateur
      a.setAttribute('download', '');
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function downloadAll() {
      // Ouvre tous les fichiers dans de nouveaux onglets (certains navigateurs peuvent bloquer les popups)
      PLANS.forEach(plan => {
        window.open(resolvePDF(plan.file), '_blank');
      });
    }

    function resolvePDF(path) {
      // Si c'est d√©j√† une URL compl√®te
      if (/^https?:\/\//i.test(path)) return path;
      // Sinon, on suppose fichier local (m√™me dossier que le HTML) ; tu peux changer la base si besoin
      return path;
      // Si tu h√©berges sur GitHub Pages, tu peux construire l'URL compl√®te :
      // return `https://betdelest.github.io/betl-models/plans/${path}`;
    }

  </script>

</body>
</html>
