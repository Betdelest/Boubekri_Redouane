<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BETL ‚Äî Visualisation AR</title>

  <!-- model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root{--accent:#0a84ff;--muted:#aaa;--bg:#000;--white:#fff;--glass:rgba(255,255,255,0.08);}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--white);font-family:Arial,Helvetica,sans-serif}

    /* --- TOP MENU --- */
    .top-menu{
      position:absolute;top:10px;left:0;width:100%;
      display:flex;justify-content:space-between;align-items:center;
      padding:0 12px;z-index:20;
    }
    .left-buttons{display:flex;gap:10px;align-items:center}
    .btn{
      padding:10px 14px;border:0;border-radius:10px;
      background:var(--glass);color:#fff;font-size:14px;cursor:pointer;
      backdrop-filter:blur(4px);
    }
    .logo-small{height:42px;border-radius:8px}

    /* --- PDF ICON BUTTON --- */
    .pdf-btn{
      width:46px;height:46px;border-radius:12px;
      background:#fff;border:0;cursor:pointer;
      display:flex;align-items:center;justify-content:center;
    }
    .pdf-btn svg{width:24px;height:24px;fill:#000;}

    /* --- MODEL VIEWER --- */
    model-viewer{width:100vw;height:100vh;display:block}

    /* --- AR BUTTON (ONLY ONE) --- */
    .ar-button{
      position:absolute;
      bottom:90px; /* üî• Remont√© */
      left:50%;transform:translateX(-50%);
      padding:14px 26px;background:#fff;color:#000;
      border:none;border-radius:14px;font-size:16px;
      font-weight:600;cursor:pointer;
      box-shadow:0 10px 28px rgba(0,0,0,0.5);
      z-index:9999;
    }

    /* --- PROGRESS --- */
    .progress-wrap{
      position:absolute;bottom:140px;left:50%;transform:translateX(-50%);
      display:flex;gap:10px;align-items:center;z-index:30;
    }
    .progress{width:240px;height:10px;background:#333;border-radius:9999px}
    .progress > span{display:block;height:100%;width:0%;background:#0a84ff}

    /* --- SPLASH --- */
    .splash{
      position:fixed;inset:0;background:#000;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      z-index:200;
    }
    .splash-logo{width:260px;animation:pulse 2.6s infinite ease-in-out}
    @keyframes pulse{0%{opacity:.8}50%{opacity:1}100%{opacity:.8}}
    .splash.hidden{opacity:0;pointer-events:none;transition:.4s}

    /* --- MODAL PDF --- */
    .modal-backdrop{
      display:none;position:fixed;inset:0;z-index:80;
      background:rgba(0,0,0,.6);align-items:center;justify-content:center;
    }
    .modal{
      width:min(700px,95%);background:#111;padding:16px;border-radius:10px;
      max-height:85vh;overflow:auto;
    }
    .plan-item{
      padding:12px;background:#1a1a1a;border-radius:10px;
      margin-bottom:8px;display:flex;justify-content:space-between;
    }
    .plan-actions button{
      padding:8px 10px;border-radius:8px;border:0;background:#fff;color:#000;
      cursor:pointer;
    }

    /* PDF preview */
    .preview-iframe{width:90vw;height:78vh;background:#fff;border-radius:8px;border:0}
  </style>
</head>

<body>

  <!-- TOP MENU -->
  <div class="top-menu">

    <div class="left-buttons">
      <a href="https://www.facebook.com/BETL121" target="_blank">
        <img src="BETL.png" class="logo-small">
      </a>

      <button class="btn" onclick="switchModel('Villa_AR.glb')">Architecture</button>
      <button class="btn" onclick="switchModel('Villa_GC.glb')">G√©nie Civil</button>
    </div>

    <!-- PDF BUTTON (icon-only) -->
    <button class="pdf-btn" onclick="openPlans()">
      <svg viewBox="0 0 24 24">
        <path d="M5 20h14a2 2 0 002-2v-6h-2v6H5V6h6V4H5a2 2 0 00-2 2v12a2 2 0 002 2zm14-11V5h-2v3h-3v2h3v3h2v-3h3V9h-3z"/>
      </svg>
    </button>

  </div>

  <!-- MODEL VIEWER -->
  <model-viewer id="viewer"
    src="https://betdelest.github.io/Boubekri_Redouane/Villa_AR.glb"
    ar ar-modes="scene-viewer webxr"
    camera-controls environment-image="neutral">

    <button slot="ar-button" class="ar-button" id="arBtn">
      Voir en R√©alit√© Augment√©e
    </button>
  </model-viewer>

  <!-- PROGRESS -->
  <div class="progress-wrap">
    <div class="progress"><span id="pbar"></span></div>
    <div id="plabel">0%</div>
  </div>

  <!-- SPLASH -->
  <div class="splash" id="splash">
    <img src="BETL.png" class="splash-logo">
    <div style="margin-top:10px;color:#ccc">Chargement‚Ä¶</div>
    <div id="splashPct" style="color:#ccc;margin-top:5px">0%</div>
  </div>

  <!-- MODAL PDF -->
  <div class="modal-backdrop" id="pdfModal">
    <div class="modal">
      <h3>Plans √† t√©l√©charger</h3>

      <div id="planList"></div>

      <button class="btn" onclick="closePlans()" style="margin-top:10px">Fermer</button>
    </div>
  </div>

  <!-- PREVIEW PDF -->
  <div class="modal-backdrop" id="previewModal">
    <div class="modal">
      <iframe id="previewFrame" class="preview-iframe"></iframe>
      <button class="btn" onclick="closePreview()" style="margin-top:10px">Fermer</button>
    </div>
  </div>

<script>
/* ------------------ BASE CONFIG ------------------ */
const BASE = "https://betdelest.github.io/Boubekri_Redouane/";

const PLANS = [
  {name:"Plan Architecture", file:"villa_Boubekri_redouane.pdf"},
  {name:"Plan G√©nie Civil", file:"Plans_Villa_GC.pdf"}
];

/* ------------------ MODEL SWITCH ------------------ */
function switchModel(filename){
  viewer.src = BASE + filename;
}

/* ------------------ PROGRESS + SPLASH ------------------ */
viewer.addEventListener("progress", e=>{
  const pct = Math.floor(e.detail.totalProgress * 100);
  pbar.style.width = pct+"%";
  plabel.textContent = pct+"%";
  splashPct.textContent = pct+"%";

  if(pct === 100){
    setTimeout(()=> splash.classList.add("hidden"), 600);
  }
});

/* ------------------ PDF MODAL ------------------ */
function openPlans(){
  planList.innerHTML = "";
  PLANS.forEach(p=>{
    planList.innerHTML += `
      <div class="plan-item">
        <div>${p.name}</div>
        <div class="plan-actions">
          <button onclick="previewPDF('${p.file}')">Voir</button>
          <button onclick="downloadPDF('${p.file}')">T√©l√©charger</button>
        </div>
      </div>`;
  });
  pdfModal.style.display = "flex";
}
function closePlans(){ pdfModal.style.display = "none"; }

function previewPDF(f){
  previewFrame.src = BASE + f;
  previewModal.style.display = "flex";
}
function closePreview(){
  previewFrame.src = "";
  previewModal.style.display = "none";
}

function downloadPDF(f){
  window.open(BASE + f, "_blank");
}

/* ------------------ AR FALLBACK INTENT ------------------ */
arBtn.onclick = async () => {
  try {
    await viewer.enterAR();
  }catch(e){
    const url = encodeURIComponent(viewer.src);
    const intent =
      `intent://arvr.google.com/scene-viewer/1.0?file=${url}&mode=ar_preferred` +
      `#Intent;scheme=https;package=com.google.android.googlequicksearchbox;end`;

    window.location.href = intent;

    setTimeout(()=>{
      alert("Si AR ne s'ouvre pas, utilisez Chrome Android.");
    },800);
  }
};
</script>

</body>
</html>
